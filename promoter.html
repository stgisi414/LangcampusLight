
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Promoter Tool - practicefor.fun</title>
    <link rel="icon" href="img/logo.png" type="image/png">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            width: 100%;
            max-width: 900px;
            margin: 0 auto;
        }

        .login-card, .promoter-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .login-card {
            max-width: 400px;
            margin: 0 auto;
        }

        .card-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .card-header h1 {
            font-size: 24px;
            margin-bottom: 8px;
        }

        .card-header p {
            opacity: 0.9;
            font-size: 14px;
        }

        .card-body {
            padding: 30px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .form-group input, .form-group textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
            font-family: inherit;
            resize: vertical;
        }

        .form-group input:focus, .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .input-area {
            min-height: 150px;
        }

        .output-area {
            min-height: 200px;
            background-color: #f8f9fa;
        }

        .btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease;
            margin-bottom: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .btn:disabled {
            opacity: 0.6;
            transform: none;
            cursor: not-allowed;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        }

        .btn-tertiary {
            background: linear-gradient(135deg, #ffc107 0%, #fd7e14 100%);
        }

        .action-buttons {
            display: grid;
            grid-template-columns: 1fr;
            gap: 10px;
            margin-bottom: 20px;
        }

        @media (min-width: 768px) {
            .action-buttons {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        .error-message {
            background: #fee;
            color: #c33;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #c33;
        }

        .success-message {
            background: #efe;
            color: #3c3;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #3c3;
        }

        .hidden {
            display: none !important;
        }

        .logout-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
        }

        .copy-btn {
            background: #6c757d;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            margin-top: 10px;
            width: auto;
        }

        .copy-btn:hover {
            background: #5a6268;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }

        .loading::after {
            content: '';
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-number {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 12px;
            opacity: 0.9;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Login Form -->
        <div id="loginForm" class="login-card">
            <div class="card-header">
                <h1>Promoter Tool</h1>
                <p>practicefor.fun - Marketing Assistant</p>
            </div>
            <div class="card-body">
                <div id="errorMessage" class="error-message hidden"></div>
                <div id="successMessage" class="success-message hidden"></div>

                <form id="loginFormElement">
                    <div class="form-group">
                        <label for="password">Access Password</label>
                        <input type="password" id="password" placeholder="Enter promoter password" required>
                    </div>
                    <button type="submit" class="btn" id="loginBtn">
                        Login
                    </button>
                </form>
            </div>
        </div>

        <!-- Promoter Tools -->
        <div id="promoterTools" class="promoter-card hidden">
            <button class="logout-btn" onclick="logout()">Logout</button>

            <div class="card-header">
                <h1>Promotion Assistant</h1>
                <p>AI-powered message generation for practicefor.fun</p>
            </div>
            <div class="card-body">
                <!-- Stats -->
                <div class="stats">
                    <div class="stat-card">
                        <div class="stat-number" id="messagesGenerated">0</div>
                        <div class="stat-label">Messages Generated</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="errorsFound">0</div>
                        <div class="stat-label">Errors Corrected</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="languagesDetected">0</div>
                        <div class="stat-label">Languages Detected</div>
                    </div>
                </div>

                <!-- Input Area -->
                <div class="form-group">
                    <label for="inputText">Profile Text or Message to Analyze</label>
                    <textarea id="inputText" class="input-area" placeholder="Paste the user's profile text or message here..."></textarea>
                </div>

                <!-- Action Buttons -->
                <div class="action-buttons">
                    <button class="btn" onclick="analyzeErrors()">
                        üìù Analyze & Draft for English Errors
                    </button>
                    <button class="btn btn-secondary" onclick="draftNonEnglish()">
                        üåç Draft for Non-English Text
                    </button>
                    <button class="btn btn-tertiary" onclick="draftShortText()">
                        ‚ú® Draft for Short/Error-Free Text
                    </button>
                </div>

                <!-- Loading Indicator -->
                <div id="loadingIndicator" class="loading hidden">
                    Generating personalized message...
                </div>

                <!-- Output Area -->
                <div class="form-group">
                    <label for="outputText">Generated Promotional Message</label>
                    <textarea id="outputText" class="output-area" readonly placeholder="Your AI-generated message will appear here..."></textarea>
                    <button class="copy-btn" onclick="copyToClipboard()" id="copyBtn" style="display: none;">
                        üìã Copy Message
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Session tracking
        let messagesGenerated = parseInt(localStorage.getItem('messagesGenerated') || '0');
        let errorsFound = parseInt(localStorage.getItem('errorsFound') || '0');
        let languagesDetected = parseInt(localStorage.getItem('languagesDetected') || '0');

        // Password for access (in production, this should be more secure)
        const PROMOTER_PASSWORD = 'PromoteForFun2024';

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            updateStats();
            
            // Check if already logged in
            if (localStorage.getItem('promoterLoggedIn') === 'true') {
                showPromoterTools();
            }
        });

        // Login form submission
        document.getElementById('loginFormElement').addEventListener('submit', function(e) {
            e.preventDefault();
            login();
        });

        function login() {
            const password = document.getElementById('password').value.trim();
            
            if (password === PROMOTER_PASSWORD) {
                localStorage.setItem('promoterLoggedIn', 'true');
                showSuccess('Login successful!');
                setTimeout(() => {
                    showPromoterTools();
                }, 1000);
            } else {
                showError('Invalid password. Please try again.');
                document.getElementById('password').value = '';
            }
        }

        function logout() {
            localStorage.removeItem('promoterLoggedIn');
            document.getElementById('promoterTools').classList.add('hidden');
            document.getElementById('loginForm').classList.remove('hidden');
            document.getElementById('password').value = '';
            hideMessages();
        }

        function showPromoterTools() {
            document.getElementById('loginForm').classList.add('hidden');
            document.getElementById('promoterTools').classList.remove('hidden');
            updateStats();
        }

        function updateStats() {
            document.getElementById('messagesGenerated').textContent = messagesGenerated;
            document.getElementById('errorsFound').textContent = errorsFound;
            document.getElementById('languagesDetected').textContent = languagesDetected;
        }

        function saveStats() {
            localStorage.setItem('messagesGenerated', messagesGenerated.toString());
            localStorage.setItem('errorsFound', errorsFound.toString());
            localStorage.setItem('languagesDetected', languagesDetected.toString());
            updateStats();
        }

        async function analyzeErrors() {
            const inputText = document.getElementById('inputText').value.trim();
            if (!inputText) {
                showError('Please enter some text to analyze.');
                return;
            }

            showLoading();

            const prompt = `You are Stefan, a helpful language learning assistant for practicefor.fun. Analyze the following profile text for English grammar, spelling, and punctuation errors.

Instructions:
1. Greet the user by name if identifiable, otherwise use "Hello"
2. Add the phrase: "Hey, I noticed you made a few mistakes in your profile."
3. For each error found:
   - Quote the incorrect text with ‚ùå emoji
   - Show the correction with ‚úÖ emoji
   - Example: "You wrote 'I enjoys practice english' ‚ùå. It should be 'I enjoy practicing English' ‚úÖ."
4. If no errors are found, acknowledge their good English but still promote the platform
5. Conclude with: "If you're looking to improve your English and get instant practice with native speakers, check out https://practicefor.fun!"
6. Sign off with: "Best regards,\\nStefan"

Profile text to analyze:
${inputText}`;

            try {
                const response = await callGeminiAPI(prompt, 'error_analysis');
                document.getElementById('outputText').value = response;
                
                // Count errors found (rough estimate based on ‚ùå symbols)
                const errorCount = (response.match(/‚ùå/g) || []).length;
                if (errorCount > 0) {
                    errorsFound += errorCount;
                }
                
                messagesGenerated++;
                saveStats();
                showCopyButton();
            } catch (error) {
                showError('Failed to generate message. Please try again.');
                console.error('Error:', error);
            } finally {
                hideLoading();
            }
        }

        async function draftNonEnglish() {
            const inputText = document.getElementById('inputText').value.trim();
            if (!inputText) {
                showError('Please enter some text to analyze.');
                return;
            }

            showLoading();

            const prompt = `You are Stefan, a helpful language learning assistant for practicefor.fun. The user has provided text that appears to be in a non-English language or mixed languages.

Instructions:
1. Analyze the text to understand its main topic or sentiment
2. Craft a positive, encouraging message in English that:
   - Acknowledges their interest or content (if discernible)
   - Smoothly transitions to promoting practicefor.fun
   - Highlights that they can find partners for instant language exchange in their native language or to practice English
3. Use phrases like: "You can connect with people from all over the world to practice [their language] or improve your English. Check it out at https://practicefor.fun!"
4. Sign off with: "Best regards,\\nStefan"

Text to respond to:
${inputText}`;

            try {
                const response = await callGeminiAPI(prompt, 'non_english_draft');
                document.getElementById('outputText').value = response;
                
                languagesDetected++;
                messagesGenerated++;
                saveStats();
                showCopyButton();
            } catch (error) {
                showError('Failed to generate message. Please try again.');
                console.error('Error:', error);
            } finally {
                hideLoading();
            }
        }

        async function draftShortText() {
            const inputText = document.getElementById('inputText').value.trim();
            if (!inputText) {
                showError('Please enter some text to analyze.');
                return;
            }

            showLoading();

            const prompt = `You are Stefan, a helpful language learning assistant for practicefor.fun. The user has provided a short message or error-free profile text.

Instructions:
1. If the text is a question or requires acknowledgment, provide a brief, polite response
2. If no specific errors are present or the text is very short, use a general approach
3. Append a promotional message: "If you're ever looking to practice languages with people from around the world, https://practicefor.fun is a great place for instant language exchange!"
4. Keep the tone friendly and natural
5. Sign off with: "Best regards,\\nStefan"

Text to respond to:
${inputText}`;

            try {
                const response = await callGeminiAPI(prompt, 'short_text_draft');
                document.getElementById('outputText').value = response;
                
                messagesGenerated++;
                saveStats();
                showCopyButton();
            } catch (error) {
                showError('Failed to generate message. Please try again.');
                console.error('Error:', error);
            } finally {
                hideLoading();
            }
        }

        async function callGeminiAPI(prompt, callType) {
            const response = await fetch('https://langcamp.us/api/exchange-admin/gemini-generate', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    prompt: prompt,
                    model: 'super',
                    callType: callType,
                    source: 'promoter_tool',
                    username: 'stefan_promoter',
                    userInfo: 'stefan_promoter',
                    userAgent: navigator.userAgent,
                    requestPreview: prompt.substring(0, 200)
                })
            });

            if (!response.ok) {
                const errorBody = await response.text();
                throw new Error(`API request failed with status ${response.status}: ${response.statusText}. Body: ${errorBody}`);
            }

            const data = await response.json();

            if (!data || !data.success) {
                throw new Error(data.error || "API returned unsuccessful response");
            }

            let generatedText = data.text;
            if (!generatedText) {
                throw new Error("No text returned from API");
            }

            return generatedText.trim();
        }

        function showLoading() {
            document.getElementById('loadingIndicator').classList.remove('hidden');
            document.querySelectorAll('.btn').forEach(btn => btn.disabled = true);
        }

        function hideLoading() {
            document.getElementById('loadingIndicator').classList.add('hidden');
            document.querySelectorAll('.btn').forEach(btn => btn.disabled = false);
        }

        function showCopyButton() {
            document.getElementById('copyBtn').style.display = 'inline-block';
        }

        function copyToClipboard() {
            const outputText = document.getElementById('outputText');
            outputText.select();
            outputText.setSelectionRange(0, 99999); // For mobile devices
            
            try {
                document.execCommand('copy');
                showSuccess('Message copied to clipboard!');
                
                // Hide success message after 2 seconds
                setTimeout(() => {
                    hideMessages();
                }, 2000);
            } catch (err) {
                showError('Failed to copy to clipboard. Please select and copy manually.');
            }
        }

        function showError(message) {
            const errorEl = document.getElementById('errorMessage');
            if (errorEl) {
                errorEl.textContent = message;
                errorEl.classList.remove('hidden');
            }
            const successEl = document.getElementById('successMessage');
            if (successEl) {
                successEl.classList.add('hidden');
            }
        }

        function showSuccess(message) {
            const successEl = document.getElementById('successMessage');
            if (successEl) {
                successEl.textContent = message;
                successEl.classList.remove('hidden');
            }
            const errorEl = document.getElementById('errorMessage');
            if (errorEl) {
                errorEl.classList.add('hidden');
            }
        }

        function hideMessages() {
            const errorEl = document.getElementById('errorMessage');
            const successEl = document.getElementById('successMessage');
            if (errorEl) errorEl.classList.add('hidden');
            if (successEl) successEl.classList.add('hidden');
        }

        // Handle enter key in password field
        document.getElementById('password').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                login();
            }
        });
    </script>
</body>
</html>
